schedules:
  - cron: "0 0 * * *"
    displayName: Daily midnight build
    branches:
      include:
        - main

steps:
  - script: npm install -g @typespec/compiler@next
    displayName: Install @typespec/compiler@next
  - template: build.yml
  - script: npm run override-dev-version
    workingDirectory: $(Build.SourcesDirectory)/packages/typespec-ts
    displayName: "Override tsp version to latest dev"
  - script: rush update --full && rush build
    workingDirectory: $(Build.SourcesDirectory)/packages/typespec-ts
    displayName: "Re-build after update the config"
  - script: npm run test
    workingDirectory: $(Build.SourcesDirectory)/packages/typespec-ts
    displayName: "Run Cadl-ranch test cases"
