trigger:
  - v6

pool:
  vmImage: "ubuntu-latest"

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "10.x"
    displayName: "Install Node.js"

  - script: |
      npm install
      npm run build
    displayName: "Build"

  - script: |
      npm run test
    displayName: "Run Tests"

  - script: |
      npm run generate:services
    displayName: "Generate Supported Service Swaggers"

  - script: |
      npm run check:tree
    displayName: "Check that the git tree is clean"

  - script: |
      npm run coverage-push -- $(Build.Repository.Name) $(Build.SourceBranch) $(github-token) $(storage-coverage-user) $(storage-coverage-pass)
    workingDirectory: node_modules/@microsoft.azure/autorest.testserver
    displayName: "Upload Coverage Report"
